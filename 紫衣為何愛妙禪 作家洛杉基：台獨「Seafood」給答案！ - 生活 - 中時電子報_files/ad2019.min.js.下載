"use strict";$(document).ready(function(){function a(a,t,e){var n=document.getElementById(a);n&&n.contentWindow.postMessage({adPublisher:"chinatimes",adIframeId:a,adState:t,adEventParamObj:e},"*")}function t(a){return document.getElementById(a)}function e(a,e){return $(t(a)).parents('div[class^="'+e+'"]')}function n(a){(function(a){return $(t(a)).parents(".ad")})(a).remove()}function o(a){return $(window).scrollTop()<a.offset().top+a.outerHeight()}function i(){var a=$("body"),t=($(window),$(".ad .banner-auto-scale.mb-0")),e=$(".ad .underlay-auto-scale");return!!a.is(".ad-underlay-auto-scale-in-viewport")||(!!a.is(".ad-outter-frame-active")||(!!a.is(".ad-banner-expandable-auto-scale-in-viewport")||(t.length?o(t):!!e.length&&o(e))))}function d(t,n,d,r,s,c){var l=e(t,n),u=l.parents(".banner-sticky"),p=$("body"),f=$(window);l.attr("data-state",s),"init-complete"===s&&(l.attr("data-size",d).attr("data-media-type",r),l.parents('[class*="-auto-scale"]').attr("data-size",d),u.length||f.on({"scroll.bannerExpandable":function(){o(l)?(p.addClass("ad-banner-expandable-auto-scale-in-viewport"),"video"===r&&a(t,"video-play")):(p.removeClass("ad-banner-expandable-auto-scale-in-viewport"),"video"===r&&a(t,"video-stop"))}})),function(t,n,o,d,r,s){var c=e(t,n),l=c.parents(".banner-sticky"),u=c.parents(".banner-auto-scale"),p=$("body"),f=$(window);if(!l.length)return;l.attr("data-state",r),"init-complete"===r&&f.on({"scroll.bannerSticky":function(){i()?"video"===d&&a(t,"video-stop"):"video"===d&&a(t,"video-play")}});"expanded"===r?(u.css("width",1240*(f.height()-20)/700),p.removeClass("ad-banner-sticky-"+o+"-collapsed").addClass("ad-banner-sticky-"+o+"-expanded")):(u.css("width",""),p.removeClass("ad-banner-sticky-"+o+"-expanded").addClass("ad-banner-sticky-"+o+"-collapsed"))}(t,n,d,r,s)}window.addEventListener("message",function(t){var r,s,c,l,u,p;if("chinatimes"===t.data.adPublisher)if("init"===t.data.adState)$(".ad iframe").each(function(t,e){a(e.id,"init")});else switch(r=t.data.adIframeId,s=t.data.adType,c=t.data.adSize,l=t.data.adMediaType,u=t.data.adState,p=t.data.adEventParamObj,s){case"banner-expandable":d(r,s,c,l,u);break;case"lightbox-auto-scale":!function(a,t,o,i,d,r){var s=e(a,t);$("html, body"),s.attr("data-state",d),"init-complete"===d&&(s.addClass("show"),s.attr("data-size",o).attr("data-media-type",i,r)),"to-close"===d&&n(a)}(r,s,c,l,u,p);break;case"banner-native-auto-scale":!function(a,t,n,o,i,d){var r,s=e(a,t);"init-complete"===i&&(s.attr("data-size",n).attr("data-media-type",o),s.prepend('<div class="place-holder"></div>')),"window-set-size"===i&&(r=d.adAspectRatio,s.find(".place-holder").css("padding-bottom",100*r+"%"))}(r,s,c,l,u,p);break;case"underlay-auto-scale":!function(t,n,i,d,r,s){var c=e(t,n),l=$("body"),u=$(window);c.attr("data-state",r),"init-complete"===r&&(c.attr("data-size",i).attr("data-media-type",d),function(){var e,n=u.width(),i=u.height();u.on({"init.underlayAutoScale":function(a){a.stopPropagation(),u.trigger("scroll.underlayAutoScale")},"scroll.underlayAutoScale":function(e,n){o(c)?(l.addClass("ad-underlay-auto-scale-in-viewport"),"video"===d&&a(t,"video-play")):(l.removeClass("ad-underlay-auto-scale-in-viewport"),"video"===d&&a(t,"video-stop"))},"resize.underlayAutoScale":function(){e=u.width(),n!==e&&(n=e,i=u.height(),u.trigger("scroll.underlayAutoScale",[!0]))}})}(),u.trigger("init.underlayAutoScale"))}(r,s,c,l,u);break;case"outter-frame":!function(t,o,i,d,r,s){var c=e(t,o),l=$("body"),u=$("body > .wrapper"),p=$(window);c.attr("data-state",r),"init-complete"===r&&(c.addClass("show"),c.attr("data-size",i).attr("data-media-type",d),l.addClass("ad-outter-frame-active"),function(){var e,n,o,d,r=p.width(),c=p.scrollTop(),l=Number(i.split("x")[0]),f=s.adContentTopBaseHeight,v=s.adContentRightBaseWidth,m=s.adPanelExpandedWidth;u.on({"init.outterFrame":function(a,t){var e=$(this);a.stopPropagation(),n=e.find("> .container").outerWidth(),d=n/l,e.css({transform:"translate3d(0, "+f*d+"px, 0) scale("+(n-v*d)/n+")",position:"absolute",left:"0",top:"0",width:"100%",clip:"rect(-10px, "+(n+30)+"px, auto, 0)"})},"reset.outterFrame":function(a){var t=$(this);a.stopPropagation(),t.css({transform:"",position:"",left:"",top:"",width:"",clip:""})},"adToExapnd.outterFrame":function(){$(this).css({transform:"translate3d(-"+(m-v)*d+"px, "+f*d+"px, 0) scale("+(n-v*d)/n+")"})}}),p.on({"resize.outterFrame":function(){e=p.width(),r!==e&&(r=e,u.trigger("init",[!0]),a(t,"window-resize"))},"scroll.outterFrame":function(){var e;e=(o=p.scrollTop())-c,c=o,a(t,"window-scroll",{scrollDistance:e})}})}(),u.trigger("init.outterFrame")),"to-close"===r&&(n(t),l.removeClass("ad-outter-frame-active"),u.trigger("reset.outterFrame").off(".outterFrame"),p.off(".outterFrame")),"to-expand"===r&&u.trigger("adToExapnd.outterFrame"),"to-collapse"===r&&u.trigger("init.outterFrame")}(r,s,c,l,u,p);break;case"banner-sticky":!function(t,o,d,r,s,c){var l=e(t,o),u=$("body"),p=$(window);l.attr("data-state",s),"init-complete"===s&&(l.attr("data-size",d).attr("data-media-type",r),p.on({"scroll.bannerSticky":function(){i()?(l.removeClass("show"),"video"===r&&a(t,"video-stop")):(l.addClass("show"),"video"===r&&a(t,"video-play"))}})),"to-close"===s&&(n(t),u.removeClass("ad-banner-sticky-"+d+"-collapsed").removeClass("ad-banner-sticky-"+d+"-expanded"),p.off(".bannerSticky")),"expanded"===s?u.removeClass("ad-banner-sticky-"+d+"-collapsed").addClass("ad-banner-sticky-"+d+"-expanded"):"collapsed"===s&&(u.removeClass("ad-banner-sticky-"+d+"-expanded").addClass("ad-banner-sticky-"+d+"-collapsed"),a(t,"collapsed"))}(r,s,c,l,u)}}),$(".ad").find('[class^="banner-sticky"]').each(function(){var a=$(this),t=a.parents(".ad"),e=a.find(".size-container"),n=a.find(".btn-close"),o=$("body"),d=$(window);n.on({click:function(){t.remove(),o.removeClass(function(a,t){var e=t.split(" "),n=[];return $.each(e,function(a,t){t.indexOf("ad-banner-sticky")>-1&&n.push(t)}),n.join(" ")}),d.off(".bannerSticky")}}),d.on({"scroll.bannerSticky":function(){var t=e.height()>0;i()||!t?a.removeClass("show"):a.addClass("show")}})})});